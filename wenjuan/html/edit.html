<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>编辑页</title>
    <link rel='stylesheet' href='../stylesheets/vendor/bootstrap.css' />
    <link rel='stylesheet' href='../stylesheets/vendor/flat-ui.css' />
    <link rel='stylesheet' href='../stylesheets/vendor/font-awesome.css' />
    <link rel='stylesheet' href='../stylesheets/style.css' />
    <script src='../js/vendor/jquery.min.js'></script>
    <script src='../js/vendor/jquery-ui.min.js'></script>
    <script src='../js/vendor/handlebars-v3.0.0.js'></script>
</head>
<body>

<div class="container">
    <div class="row">
        <div class="edit-leftwrapper">
            <ul class="draggnav" id="J-draggnav">
                <li data-change="true" data-type="radio"><span class="fui-radio-checked"></span>单选题</li>
                <li data-change="true" data-type="checkbox"><span class="fui-checkbox-checked"></span>多选题</li>
                <li data-change="true" data-type="img-radio"><span class="fui-image"></span>图片单选题</li>
                <li data-change="true" data-type="img-checkbox"><span class="fui-image"></span>图片多选题</li>
                <li data-change="true" data-type="single-input"><span>A</span>单行填空题</li>
                <li data-change="true" data-type="multi-input"><span class="fui-list-columned"></span>多项填空题</li>
                <li data-change="true" data-type="textarea"><span class="fui-folder"></span>多行填空题</li>
                <li data-change="true" data-type="sort"><span class="fui-upload"></span>排序题</li>
                <li data-change="true" data-type="score"><span class="fui-star-2"></span>打分题</li>
                <li data-change="true" data-type="matrix-radio"><span class="fui-list-numbered"></span>矩阵单选题</li>
                <li data-change="true" data-type="matrix-checkbox"><span class="fui-list-numbered"></span>矩阵多选题</li>
                <li data-change="true" data-type="matrix-input"><span class="fui-list-numbered"></span>矩阵填空题</li>
                <li data-change="true" data-type="info"><span class="fui-tag"></span>段落说明</li>
                <li data-change="true" data-type="pagination"><span class="fui-clip"></span>分页</li>
            </ul>
        </div>
        <div class="edit-rightwrapper">
            <div class='panel panel-default'>
                <div class='panel-heading'>
                    <label>问卷标题</label>
                    <input placeholder="填写标题"/>
                </div>
                <div class='panel-body' style="height:100px;">
                    <label>问卷描述</label>
                    <textarea placeholder="填写描述"></textarea>
                </div>
            </div>
            <ul class="sortnav" id="J-sortarea">
            </ul>

        </div>
    
    </div>
</div>

<style>
    .fui-plus-circle{cursor:pointer;}
</style>


<script type="text/html" id="M-radio">
    <label class="radio">
        <input type="radio" /><input type="text" placeholder="填写选项" value="选项1"/>
    </label>
    <label class="radio">
        <input type="radio" /><input type="text" placeholder="填写选项" value="选项2"/>
    </label>
    <span class="fui-plus-circle"></span>
    <p>这是一道单选题，请设置问题和选项</p>
</script>
<script type="text/html" id="M-checkbox">
    <label class="checkbox">
        <input type="checkbox" /><input type="text" placeholder="填写选项" value="选项1"/>
    </label>
    <label class="checkbox">
        <input type="checkbox" /><input type="text" placeholder="填写" value="选项2"/>
    </label>
    <span class="fui-plus-circle"></span>
    <p>这是一道多选题，请设置问题和选项</p>
</script>
<script type="text/html" id="M-img-radio">
    <div class="img-area">
        <img src="../images/test/icon_tel.png" width=140 height=140/>
        <label class="radio">
            <input type="radio" /><input type="text" placeholder="填写选项" value="选项1"/>
        </label>
        
    </div>
    <div class="img-area uploader">
        <input type="file" name="files[]" title="点击添加图片"/>
        <span class="fui-image"></span>
    </div>
</script>
<script type="text/html" id="M-img-checkbox">
    <div class="img-area">
        <img src="../images/test/icon_tel.png" width=140 height=140/>
        <label class="checkbox">
            <input type="checkbox" /><input type="text" placeholder="填写选项" value="选项1"/>
        </label>
        
    </div>
    <div class="img-area uploader">
        <input type="file" name="files[]" title="点击添加图片"/>
        <span class="fui-image"></span>
    </div>
</script>
<script type="text/html" id="M-single-input">
    <input type="text" disabled/ >
</script>
<script type="text/html" id="M-multi-input">
    <label><input placeholder="选项一" type="text" value="选项" /></label>
    <input type="text"/ disabled>
    <label><input placeholder="选项二" type="text" value="选项" /></label>
    <input type="text"/ disabled>
    <span class="fui-plus-circle"></span>
</script>
<script type="text/html" id="M-textarea">
    <textarea disabled></textarea>
</script>
<script type="text/html" id="M-sort">
    <div class="sort-left">
        <div><input placeholder="选项1"/></div>
        <div><input placeholder="选项2"/></div>
    </div>
    <div class="sort-right">
        <table class="table table-bordered">
            <tbody>
                <tr>
                    <td>1</td>
                    <td>...</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>...</td>
                </tr>
            </tbody>
        </table>
    </div>
</script>
<script type="text/html" id="M-score">
    <label class="score-area">
        <input type="text" placeholder="填写选项" value="选项1" class="score-area-left"/>
        <div class="score-area-right">
            <span class="fui-star-2" style="color:grey"></span>
            <span class="fui-star-2" style="color:grey"></span>
            <span class="fui-star-2"></span>
            <span class="fui-star-2"></span>
            <span class="fui-star-2"></span>
        </div>
    </label>
    <label class="score-area">
        <input type="text" placeholder="填写选项" value="选项2" class="score-area-left"/>
        <div class="score-area-right">
            <span class="fui-star-2" style="color:grey"></span>
            <span class="fui-star-2" style="color:grey"></span>
            <span class="fui-star-2"></span>
            <span class="fui-star-2"></span>
            <span class="fui-star-2"></span>
        </div>
    </label>

</script>
<script type="text/html" id="M-matrix-radio">
    <table class="table table-bordered">
        <thead>
            <tr>
                <th></th>
                <th><input type="text" placeholder="填写选项" value="选项一" /></th>
                <th><input type="text" placeholder="填写选项" value="选项二" /></th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><input type="text" placeholder="填写行名" value="行名" /></td>
                <td><input type="radio"/ ></td>
                <td><input type="radio"/ ></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="填写行名" value="行名" /></td>
                <td><input type="radio"/ ></td>
                <td><input type="radio"/ ></td>
            </tr>
        </tbody>
    </table>
</script>
<script type="text/html" id="M-matrix-checkbox">
    <table class="table table-bordered">
        <thead>
            <tr>
                <th></th>
                <th><input type="text" placeholder="填写选项" value="选项一" /></th>
                <th><input type="text" placeholder="填写选项" value="选项二" /></th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><input type="text" placeholder="填写行名" value="行名" /></td>
                <td><input type="checkbox"/ ></td>
                <td><input type="checkbox"/ ></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="填写行名" value="行名" /></td>
                <td><input type="checkbox"/ ></td>
                <td><input type="checkbox"/ ></td>
            </tr>
        </tbody>
    </table>
</script>
<script type="text/html" id="M-matrix-input">
    <table class="table table-bordered">
        <thead>
            <tr>
                <th></th>
                <th><input type="text" placeholder="填写选项" value="选项一" /></th>
                <th><input type="text" placeholder="填写选项" value="选项二" /></th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><input type="text" placeholder="填写行名" value="行名" /></td>
                <td><input type="text" disabled /></td>
                <td><input type="text" disabled /></td>
            </tr>
            <tr>
                <td><input type="text" placeholder="填写行名" value="行名" /></td>
                <td><input type="text" disabled /></td>
                <td><input type="text" disabled /></td>
            </tr>
        </tbody>
    </table>
</script>
<script type="text/html" id="M-info">
</script>
<script type="text/html" id="M-pagination">
</script>
<script type="text/html" id="M-pannel">
    <div class='panel panel-default'>
        <div class='panel-heading'>
            <span class="J-order"></span>
            <input type="text" placeholder="填写标题" name="title" value="填写标题"/>
            <div class="fr action-area">
                <span class="fui-triangle-up"></span>    
                <span class="fui-triangle-down"></span>    
                <span class="fui-trash"></span>    
            </div>
        </div>
       <div class='panel-body'>
       </div>
    </div>
</script>

<script>
$(function() {
    /*左侧拖拉*/
    $('#J-draggnav li').draggable({
        connectToSortable: '#J-sortarea',
        addClasses: false,
        helper: 'clone',
        cursor: "move",
        revert: 'invalid',
        stop: function(event, ui){
            rebuild('#J-sortarea');
            //resort('#J-sortarea');
        }
    });
    /*右侧排序*/
    $('#J-sortarea').sortable({
        handle: ".panel-heading",
        cursor: "move",
        revert: true,
        stop: function(event, ui){
            resort('#J-sortarea');
        }
    });


    /*重建右侧*/
    function rebuild(id) {
        $(id).children('li').each(function() {
            // 遍历子节点，转化刚刚加入的项目
            if ($(this).attr('data-type') && $(this).attr('data-change') == 'true') {
                $(this).attr('data-change', false);
                switchbuild($(this));
           }
        });
    }


    /*右侧序列生成*/
    function resort(id) {
        var count = 1,
            order_list = [];
        $(id).children('li').each(function() {
            if ($(this).attr('data-type')) {
                order_list.push($(this).attr('id'));
                $(this).find('.J-order').html('Q' + count++);
            }
        });
        // 每次操作以后输出序列顺序
        console.log('发送序列顺序:' + order_list);
    }

    /*节点转化*/
    function switchbuild(node) {
        var type = node.attr('data-type'),
            d = new Date().getTime();
        node.attr('id', 'J-wj' + d);
        var pannel = $($('#M-pannel').html());
        pannel.find('.panel-body').html($('#M-' + type).html());

        node.html('');
        node.append(pannel);
        node.css('width', '100%');
        node.css('height', '');

        // 标题处自动获取焦点
        //node.find('.panel-heading input').focus();





        console.log('新添加项目:' + node.attr('data-type') + ' id:' + node.attr('id')); 
    }


    $("#J-sortarea").delegate(".fui-triangle-up","click",function(e){
        var node = $(this).parents('li'),
            node_prev = node.prev(),
            id = node.attr('id');

        node.insertBefore(node_prev);

        resort('#J-sortarea');
        console.log('------' + id + '向上调整');
    });


    $("#J-sortarea").delegate(".fui-triangle-down","click",function(e){
        var node = $(this).parents('li'),
            node_next = node.next(),
            id = node.attr('id');

        node.insertAfter(node_next);

        resort('#J-sortarea');
        console.log('------' + id + '向下调整');
    });
    $("#J-sortarea").delegate(".fui-trash","click",function(e){
        var node = $(this).parents('li'),
        id = node.attr('id');
        node.remove();

        resort('#J-sortarea');
        console.log('------' + id + '删除');
    });


    $('#J-sortarea').on('focusin focusout', 'input[type="text"]', function(event){
        var node = $(this).parents('li');
        var id = node.attr('id');
        if(event.type === 'focusin'){
            $(this).css('background-color', 'yellow');
            //default_input_value = jQuery(this).val();
            //jQuery(this).val('');
            console.log('+++++++ 进入');
        }else if(event.type === 'focusout'){
            $(this).css('background-color', 'white');
            console.log('+++++++ 离开 +++++++ 修改 id:' + id + '下input ' + $(this).attr('name') +  '值为' + $(this).val());
        }
    });

});
</script>
</body>
</html>
